<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Salmon Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

    <script src="Salmon_habitat.js"></script>

    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100vw; height: 100vh; }

        #intro-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .intro-content {
            background: #003366;
            padding: 40px;
            border-radius: 10px;
            max-width: 600px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .intro-content h1 { margin-top: 0; color: #89CFF0; }
        .intro-content p { font-size: 1.2em; line-height: 1.6; }
        .intro-content button {
            background-color: #2ECC71;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        .intro-content button:hover {
            background-color: #27ae60;
        }

    </style>
</head>
<body>

     <!-- Intro Popup -->
    <div id="intro-popup">
        <div class="intro-content">
            <h1>Wild Atlantic Salmon</h1>
            <p>Welcome to the Wild Atlantic Salmon Habitat Risk Zone Assessment.</p>
            <p>This map visualizes the risk levels associated with salmon habitats across the region using data points.</p>
            <button id="start-btn">Are you ready to check the status of the fish?</button>
        </div>
    </div>

    <div class="info-title">
       <h3>The Wild Atlantic Salmon</h3>
       <p>Habitat Risk Zone Assessment Points</p>
   </div>

   <div id="map"></div>


    <script>
         // Intro Screen Logic
    document.getElementById('start-btn').addEventListener('click', function() {
        document.getElementById('intro-popup').style.display = 'none';
    });
    // 1. Initialize Map
    var map = L.map('map').setView([50, 10], 4);

    // 2. Add Basemap
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap &copy; CARTO'
    }).addTo(map);

    // 3. Risk classification
    function getRiskColor(risk) {
        return risk === 1 ? '#2ECC71' :   // Low
            risk === 2 ? '#F1C40F' :   // Moderate
            risk === 3 ? '#E67E22' :   // High
            risk === 4 ? '#E74C3C' :   // Very High
                            '#999999';  // fallback
    }

    // 4. Array to store markers for animation
    var animatedMarkers = [];
 // Store original positions for oscillation
  var originalPositions = [];
    // 5. Load JSON file (points)
    fetch('points_salmon_data.json')
    .then(res => res.json())
    .then(data => {

        // ESRI JSON stores points in data.features
        var features = data.features;

        features.forEach(function(f) {

        var lat = f.attributes.Latitude_Decimal;
        var lng = f.attributes.Longitude_Decimal;
        var risk = Number(f.attributes.Risk_score_new);

        var marker = L.circleMarker([lat, lng], {
            radius: 3,
            fillColor: getRiskColor(risk),
            color: '#333',
            weight: 0.5,
            fillOpacity: 0.8
        }).addTo(map);

        marker.bindPopup(`<b>Risk level:</b> ${risk}`);
        animatedMarkers.push(marker);
         originalPositions.push({lat: lat, lng: lng}); // save original position
        });

        // Zoom to all points
        var group = new L.featureGroup(animatedMarkers);
        map.fitBounds(group.getBounds());

       
      // Start oscillation
      oscillateMarkers();

    })
    .catch(err => console.error('JSON loading error:', err));

  // 6. Oscillation animation
  var t = 0; // time variable

  function oscillateMarkers() {
    t += 0.05; // speed of oscillation

    animatedMarkers.forEach((marker, i) => {
      var orig = originalPositions[i];

      // Oscillate latitude and longitude with sine wave
      var offsetLat = 0.02 * Math.sin(t + i); // small oscillation
      var offsetLng = 0.02 * Math.cos(t + i); // small oscillation

      marker.setLatLng([orig.lat + offsetLat, orig.lng + offsetLng]);
    });

    requestAnimationFrame(oscillateMarkers);
  }
    </script>



</body>
</html>